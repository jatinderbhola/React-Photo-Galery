(this["webpackJsonpreact-photo-gallery"]=this["webpackJsonpreact-photo-gallery"]||[]).push([[0],{127:function(e,t,n){},131:function(e,t,n){},132:function(e,t,n){},133:function(e,t,n){},134:function(e,t,n){},136:function(e,t,n){"use strict";n.r(t);var o=n(0),c=n.n(o),s=n(9),i=n.n(s),r=(n(57),n(3)),a=n(4),l=n(8),u=n(7),p=(n(58),n(2)),d=function(){return Object(p.jsxs)("div",{className:"homepage",children:[Object(p.jsx)("h1",{children:"CrowdRiff : Photo Gallery"}),Object(p.jsx)("p",{children:"made with \u2764\ufe0f by Jatinder bhola (JatinderBhola@gmail.com)"})]})},j=n(50),b=n.n(j).a.create({baseURL:"http://localhost:3001/",headers:{"Content-type":"application/json"}}),g=new(function(){function e(){Object(r.a)(this,e)}return Object(a.a)(e,[{key:"getAll",value:function(){return b.get("/photos")}}]),e}()),m=n(51),f=n.n(m),h=(n(127),n(6)),O="SET_IMAGES",v="CLEAR_SELECTED",x="SET_SELECTED",y="PENDING_IMAGE_APPROVAL",C=function(){return{type:v}},S=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){return Object(r.a)(this,n),t.call(this)}return Object(a.a)(n,[{key:"componentDidMount",value:function(){var e=this;g.getAll().then((function(t){e.props.setImages(t.data.photos)})).catch((function(e){return console.log(e)}))}},{key:"render",value:function(){return Object(p.jsx)("div",{className:"image-grid",children:Object(p.jsx)(f.a,{images:this.props.images,backdropClosesModal:!0,className:"image",onSelectImage:this.props.setSelected,lightboxWidth:1536})})}}]),n}(o.Component),k=Object(h.b)((function(e){return{images:e.image.images}}),(function(e){return{setImages:function(t){return e(function(e){return{type:O,images:e}}(t))},setSelected:function(t){return e(function(e){return{type:x,index:e}}(t))}}}))(S),w=n(16),I=n(17),A=n(21),N=(n(131),function(e){var t=e.setPopUp,n=e.selectedCount;return Object(p.jsxs)("div",{className:"PopUp",children:[Object(p.jsx)("button",{className:"popup-x",onClick:function(){return t(!1,null)},children:" x "}),Object(p.jsx)("div",{className:"pu-content-container",children:Object(p.jsxs)("h1",{children:["Send ",n," photos to website"]})}),Object(p.jsxs)("div",{className:"pu-button-container",children:[Object(p.jsx)("input",{className:"button-style",type:"button",onClick:function(){return t(!1,null)},value:"Cancel"}),Object(p.jsx)("input",{className:"button-style",type:"button",disabled:0===n,onClick:function(){return t(!1,!0)},value:"send"})]})]})}),E=(n(132),n(11)),P=new(function(){function e(){Object(r.a)(this,e)}return Object(a.a)(e,[{key:"host",get:function(){return"/ws"}},{key:"post",value:function(e){return b.post("website/photos/".concat(e))}}]),e}()),U=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var o;return Object(r.a)(this,n),(o=t.call(this,e)).timeout=250,o.connect=function(){var e,t=new WebSocket("ws://localhost:3001/ws"),n=Object(A.a)(o);t.onopen=function(){console.log("connected websocket main component"),o.setState({ws:t}),n.timeout=250,clearTimeout(e)},t.onclose=function(t){console.log("Socket is closed. Reconnect will be attempted in ".concat(Math.min(10,(n.timeout+n.timeout)/1e3)," second."),t.reason),n.timeout=n.timeout+n.timeout,e=setTimeout(o.check,Math.min(1e4,n.timeout))},t.onerror=function(e){console.error("Socket encountered error: ",e.message,"Closing socket"),t.close()},t.onmessage=function(e,t){console.log({event:e,err:t}),o.props.pendingImageApproval({type:"reset-upload-count-by-1",count:1})}},o.check=function(){var e=o.state.ws;e&&e.readyState!=WebSocket.CLOSED||o.connect()},o.togglePopUp=function(e,t){if("boolean"===typeof e?o.setState({popUp:e}):o.setState({popUp:!o.state.popUp}),"boolean"===typeof t&&!0===t){var n=o.props.images.filter((function(e){return e.isSelected}));if(n&&n.length>0){o.props.pendingImageApproval({type:"set-upload-count",count:n.length}),E.b.warn("Uploading images for approval!");var c=n.map((function(e){return P.post(e.id)}));Promise.allSettled(c).then((function(e){e.forEach((function(e){if("rejected"===e.status){var t,n,c,s,i,r;if(o.props.pendingImageApproval({type:"reset-upload-count-by-1",count:1}),null===e||void 0===e||null===(t=e.reason)||void 0===t||null===(n=t.response)||void 0===n||null===(c=n.data)||void 0===c?void 0:c.error)E.b.error(null===e||void 0===e||null===(s=e.reason)||void 0===s||null===(i=s.response)||void 0===i||null===(r=i.data)||void 0===r?void 0:r.error);else E.b.error("Photo is already uploaded!",{autoClose:5e3});console.error({result:e})}}))}))}}},o.state={ws:null,popUp:!1},o}return Object(a.a)(n,[{key:"componentDidMount",value:function(){this.connect()}},{key:"render",value:function(){return Object(p.jsxs)("div",{children:[Object(p.jsx)(w.a,{icon:I.a,size:"lg",title:"post images for approval",onClick:this.togglePopUp}),this.state.popUp&&Object(p.jsx)(N,{selectedCount:this.props.selectedCount,setPopUp:this.togglePopUp})]})}}]),n}(o.Component),M=Object(h.b)((function(e){return{selectedCount:e.image.selectedCount,images:e.image.images}}),(function(e){return{pendingImageApproval:function(t){return e({type:y,process:t})},clearSelected:function(){return e(C())}}}))(U),D=(n(133),function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){return Object(r.a)(this,n),t.call(this)}return Object(a.a)(n,[{key:"render",value:function(){return Object(p.jsx)("div",{className:"footer",children:Object(p.jsxs)("div",{className:"child-section margin",children:[Object(p.jsx)(w.a,{icon:I.b,size:"lg",title:"clear selection",onClick:this.props.clearSelected}),Object(p.jsx)("div",{children:Object(p.jsx)("div",{children:(0===this.props.selectedCount?"No Image Selected":1===this.props.selectedCount&&"1 Image Selected")||this.props.selectedCount+" Images Selected"})}),Object(p.jsxs)("div",{className:"child-section width",children:[Object(p.jsx)(M,{selectedCount:this.props.selectedCount}),Object(p.jsx)(w.a,{icon:I.c,size:"lg",title:"post images for approval"})]})]})})}}]),n}(o.Component)),L=Object(h.b)((function(e){return{selectedCount:e.image.selectedCount}}),(function(e){return{clearSelected:function(){return e(C())}}}))(D),T=(n(134),function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){return Object(r.a)(this,n),t.call(this)}return Object(a.a)(n,[{key:"render",value:function(){return Object(p.jsx)("div",{children:this.props.pendingImageApproval>0&&Object(p.jsx)("div",{className:"lds-heart",children:Object(p.jsx)("div",{})})})}}]),n}(o.Component)),R=Object(h.b)((function(e){return{pendingImageApproval:e.image.pendingImageApproval}}))(T),_=(n(135),function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){return Object(r.a)(this,n),t.call(this)}return Object(a.a)(n,[{key:"render",value:function(){return Object(p.jsxs)("div",{className:"App",children:[Object(p.jsx)(d,{}),Object(p.jsx)(k,{}),Object(p.jsx)(L,{}),Object(p.jsx)(R,{}),Object(p.jsx)(E.a,{autoClose:2e3})]})}}]),n}(c.a.Component)),G=n(15),J=n(10),z={images:[],selectedCount:0,pendingImageApproval:0},W=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O:return Object(J.a)(Object(J.a)({},e),{},{images:t.images,selectedCount:t.images.filter((function(e){return e.isSelected})).length});case v:return Object(J.a)(Object(J.a)({},e),{},{images:e.images.map((function(e){return!0===e.isSelected&&(e.isSelected=!1),e})),selectedCount:0});case x:var n=e.images.slice(),o=e.images[t.index];return Object.prototype.hasOwnProperty.call(o,"isSelected")?o.isSelected=!o.isSelected:o.isSelected=!0,Object(J.a)(Object(J.a)({},e),{},{images:n,selectedCount:n.filter((function(e){return e.isSelected})).length});case y:var c=e.pendingImageApproval;return"set-upload-count"===t.process.type?c+=t.process.count:c-=t.process.count,0===c&&(c=0,e.images=e.images.map((function(e){return!0===e.isSelected&&(e.isSelected=!1),e})),e.selectedCount=0,E.b.success("Approval completed!")),Object(J.a)(Object(J.a)({},e),{},{pendingImageApproval:c});default:return e}},B=Object(G.b)({image:W}),F=n(52),V=function(e){return function(t){return function(n){console.group(n.type),console.info("dispatching",n);var o=t(n);return console.log("next state",e.getState()),console.groupEnd(),o}}},q=Object(G.a)(V,F.a),H=Object(G.c)(q),K=Object(G.d)(B,void 0,H);i.a.render(Object(p.jsx)(c.a.Fragment,{children:Object(p.jsx)(h.a,{store:K,children:Object(p.jsx)(_,{})})}),document.getElementById("root"))},57:function(e,t,n){},58:function(e,t,n){}},[[136,1,2]]]);
//# sourceMappingURL=main.18d827d9.chunk.js.map